(function(a){a.fn.extend({drawbox:function(d){d=a.extend({lineWidth:1,lineCap:"butt",lineJoin:"miter",miterLimit:10,strokeStyle:"black",fillStyle:"none",shadowOffsetX:0,shadowOffsetY:0,shadowBlur:0,shadowColor:"none",colorSelector:false,colors:["black","red","orange","yellow","green","blue","indigo","violet"],showClear:true,clearLabel:"Clear Canvas",clearStyle:"button"},d);return this.each(function(){if(this.nodeName=="CANVAS"||navigator.userAgent.indexOf("MSIE")!=-1){a(this).css("cursor","pointer");
a(this).attr("onclick","function onclick(event) { void 1; }");if(this.getContext){var t=this,b=this.getContext("2d"),e=a(this).attr("id");a(this).after('<div id="'+e+'-controls" style="width:'+a(this).width()+'px"></div>');b.underInteractionEnabled=true;b.lineWidth=d.lineWidth;b.lineCap=d.lineCap;b.lineJoin=d.lineJoin;b.miterLimit=d.miterLimit;b.strokeStyle=d.strokeStyle;b.fillStyle=d.fillStyle;b.shadowOffsetX=d.shadowOffsetX;b.shadowOffsetY=d.shadowOffsetY;b.shadowBlur=d.shadowBlur;b.shadowColor=
d.shadowColor;if(d.colorSelector==true){var j="";for(i in d.colors){var u=d.colors[i];if(i==0)b.strokeStyle=u;j=j+'<div style="height:16px;width:16px;background-color:'+u+";margin:2px;float:left;border:2px solid "+(i==0?"#000":"transparent")+'"'+(i==0?' class="selected"':"")+"></div>"}a("#"+e+"-controls").append('<div style="float:left" id="'+e+'-colors">'+j+"</div>")}if(d.showClear==true){j=d.clearStyle=="link"?"div":"button";a("#"+e+"-controls").append("<"+j+' id="'+e+'-clear" style="float:right">'+
d.clearLabel+"</"+j+'><br style="clear:both" />');clear=true}var l=e+"-data";a(this).after('<input type="hidden" id="'+l+'" name="'+l+'" />');var o=false,v=a("#"+e).height(),w=a("#"+e).width(),f="",p=0,q=0,B=a(this).attr("offsetLeft"),C=a(this).attr("offsetTop"),k=false,r=false,x=false,g=false,h=false;a(document).mousedown(function(c){y(c)});a(document).mousemove(function(c){z(c)});a(document).mouseup(function(){s()});a(document).bind("touchstart",function(c){y(c)});a(document).bind("touchmove",function(c){z(c)});
a(document).bind("touchend",function(){s()});a(document).bind("touchcancel",function(){s()});a("#"+e+"-colors div").click(function(){a("#"+e+"-controls div").css("borderColor","transparent").removeClass("selected");a(this).addClass("selected");a(this).css("borderColor","#000")});a("#"+e+"-clear").click(function(){b.save();b.beginPath();b.closePath();b.restore();b.clearRect(0,0,a(t).width(),a(t).height());a("#"+l).val("")});var A=function(c){if(typeof event!="undefined"&&typeof event.touches!="undefined"){c=
event.touches.item(0);p=document.body.scrollLeft;q=document.body.scrollTop}else{p=a(document).scrollLeft();q=a(document).scrollTop()}if(g!=false){r=g;x=h}g=c.clientX-(B-p);h=c.clientY-(C-q);return c},m=function(c){if(c!="stop"){if(c=="start"){x=r=k=false;b.beginPath();b.moveTo(g,h);f='<polyline points="'}else{if(r==false){g+=1;h+=1}b.lineTo(g,h)}b.stroke();if(f.length>0&&f.substring(f.length-1)!='"')f+=" ";f=f+g+","+h;if(g>0&&g<=w&&h>0&&h<=v)k=true}else{m("move");if(k==true){f=f+'" style="fill:'+
d.fillStyle+";stroke:"+b.strokeStyle+";stroke-width:"+b.lineWidth+'" /></svg>';c=a("#"+l);var n=c.val();if(n=="")n='<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg width="'+w+'" height="'+v+'" version="1.1" xmlns="http://www.w3.org/2000/svg"></svg>';c.val(n.substring(0,n.length-6)+f)}}},y=function(c){k==true&&c.preventDefault();o=true;A(c);b.strokeStyle=a("#"+e+"-colors div.selected").css("backgroundColor");
m("start")},z=function(c){k==true&&c.preventDefault();if(o==true){A(c);m("move")}return false},s=function(){o=false;m("stop")}}else alert("Your browser does not support <canvas>")}else alert(".drawbox() only works on <canvas> elements")})}})})(jQuery);
